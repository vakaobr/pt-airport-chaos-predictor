<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üáµüáπ Airport Queue Predictor</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;800&family=Crimson+Pro:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <div class="grain-overlay"></div>
    
    <header class="hero">
        <div class="container">
            <h1 class="title">
                <span class="title-main">üáµüáπ Airport Queue</span>
                <span class="title-sub">Predictor</span>
            </h1>
            <p class="subtitle">Real-time crowd forecasting for Portuguese airports based on non-EU flight schedules</p>
        </div>
    </header>

    <main class="container">
        <section class="context-section">
            <div class="context-card">
                <h3 class="context-title">üì∞ Why This Tool Exists</h3>
                <p class="context-text">
                    Following recent chaos at Portuguese airports due to border control suspensions and severe staff shortages, 
                    travelers are facing unprecedented wait times. This tool helps you predict crowd levels and plan accordingly.
                </p>
                <div class="context-links">
                    <h4 class="context-links-title">Recent News:</h4>
                    <ul class="context-news-list">
                        <li>
                            <a href="https://www.aman-alliance.org/Home/ContentDetail/98848" target="_blank" rel="noopener noreferrer">
                                AMAN Alliance: Border Control Chaos Updates
                                <span class="external-icon">‚Üó</span>
                            </a>
                        </li>
                        <li>
                            <a href="https://www.portugalresident.com/portuguese-vip-writes-to-pm-over-continuing-border-chaos-at-lisbon-airport/" target="_blank" rel="noopener noreferrer">
                                Portuguese VIP writes to PM over continuing border chaos
                                <span class="external-icon">‚Üó</span>
                            </a>
                        </li>
                        <li>
                            <a href="https://www.theportugalnews.com/news/2025-12-30/government-accused-of-incompetence-after-border-suspension-at-lisbon-airport/938226" target="_blank" rel="noopener noreferrer">
                                Government accused of incompetence after border suspension
                                <span class="external-icon">‚Üó</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </section>

        <section class="controls-section">
            <div class="control-group">
                <label for="airport">Select Airport</label>
                <select id="airport" class="input-select">
                    <option value="">Choose an airport...</option>
                    <option value="LIS">Lisbon (LIS) - Humberto Delgado</option>
                    <option value="OPO">Porto (OPO) - Francisco S√° Carneiro</option>
                    <option value="FAO">Faro (FAO) - Algarve</option>
                    <option value="FNC">Funchal (FNC) - Madeira</option>
                    <option value="PDL">Ponta Delgada (PDL) - Azores</option>
                </select>
                <small class="helper-text" style="visibility: hidden;">Placeholder</small>
            </div>

            <div class="control-group">
                <label for="date">Select Date</label>
                <input type="date" id="date" class="input-date">
                <small class="helper-text">Available for today and next 2 days</small>
            </div>

            <div class="control-group button-group">
                <label style="visibility: hidden;">Action</label>
                <button id="predictBtn" class="btn-predict" disabled>
                    <span class="btn-text">Predict Crowds</span>
                    <span class="btn-arrow">‚Üí</span>
                </button>
            </div>
        </section>

        <section id="resultsSection" class="results-section hidden">
            <div class="loading" id="loading">
                <div class="loading-spinner"></div>
                <p>Analyzing flight data...</p>
            </div>

            <div id="results" class="results hidden">
                <div id="warningBanner" class="warning-banner hidden">
                    <div class="warning-icon">‚ö†Ô∏è</div>
                    <div class="warning-content">
                        <strong class="warning-title" id="warningTitle">Notice</strong>
                        <p class="warning-message" id="warningMessage"></p>
                    </div>
                    <button class="warning-close" id="closeWarning" aria-label="Close warning">√ó</button>
                </div>

                <div class="crowd-card">
                    <div class="crowd-header">
                        <h2 class="crowd-title">Crowd Level Prediction</h2>
                        <div id="crowdBadge" class="crowd-badge"></div>
                    </div>
                    
                    <div class="crowd-visual">
                        <div class="crowd-meter">
                            <div id="crowdBar" class="crowd-bar"></div>
                        </div>
                        <div class="crowd-labels">
                            <span>Quiet</span>
                            <span>Moderate</span>
                            <span>Busy</span>
                            <span>Very Busy</span>
                        </div>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-item clickable" id="arrivalsPanel" data-type="arrivals" title="Click to view arrivals timetable">
                            <div class="stat-label">Non-EU Arrivals</div>
                            <div id="arrivals" class="stat-value">-</div>
                        </div>
                        <div class="stat-item clickable" id="departuresPanel" data-type="departures" title="Click to view departures timetable">
                            <div class="stat-label">Non-EU Departures</div>
                            <div id="departures" class="stat-value">-</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Total Passengers</div>
                            <div id="totalPassengers" class="stat-value">-</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Peak Period</div>
                            <div id="peakTime" class="stat-value">-</div>
                        </div>
                    </div>
                </div>

                <div class="chart-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3 class="chart-title" style="margin-bottom: 0;">Hourly Flight Distribution</h3>
                        <small style="color: var(--color-gray); font-style: italic;">üí° Click a bar to see flights</small>
                    </div>
                    <div class="chart-container">
                        <canvas id="flightsChart"></canvas>
                    </div>
                </div>

                <div class="flights-card">
                    <h3 class="flights-title">Peak Hour Flights</h3>
                    <div id="flightsList" class="flights-list"></div>
                </div>

                <div id="timetableCard" class="timetable-card hidden">
                    <div class="timetable-header">
                        <h3 class="timetable-title" id="timetableTitle">Flight Timetable</h3>
                        <button class="timetable-close" id="closeTimetable" aria-label="Close timetable">√ó</button>
                    </div>
                    
                    <div class="timetable-tabs">
                        <button class="timetable-tab active" data-tab="all">All Flights</button>
                        <button class="timetable-tab" data-tab="arrivals">Arrivals</button>
                        <button class="timetable-tab" data-tab="departures">Departures</button>
                    </div>
                    
                    <div class="timetable-content" id="timetableContent">
                        <!-- Table will be inserted here -->
                    </div>
                </div>

                <div class="info-card">
                    <h4>üí° Tips for Travelers</h4>
                    <ul id="travelTips"></ul>
                    <hr style="margin: 1.5rem 0; border: none; border-top: 1px solid rgba(255,255,255,0.2);">
                    <p style="font-size: 0.9rem; opacity: 0.9; margin: 0;">
                        <strong>How we calculate crowd levels:</strong> We count non-EU flights and estimate passengers based on actual aircraft types. Larger aircraft (A380, B777) carry 300-500+ passengers, while smaller aircraft (A320, B737) carry 150-220 passengers.
                    </p>
                </div>
            </div>

            <div id="error" class="error-message hidden"></div>
        </section>
    </main>

    <footer class="footer">
        <div class="container">
            <p>Data powered by FlightAware API ‚Ä¢ Built to help travelers navigate Portuguese airport queues</p>
            <p class="disclaimer">Predictions are estimates based on scheduled flights. Actual wait times may vary.</p>
            <button id="clearCacheBtn" class="clear-cache-btn" title="Clear all cached flight data">
                üóëÔ∏è Clear Cache
            </button>
        </div>
    </footer>

    <script src="/script.js"></script>
</body>
</html>
